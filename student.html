<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAHARA - Your Mental Wellness Companion</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
     <link rel="manifest" href="/manifest.json">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: rgba(245, 245, 245, 0.6);
            --bg-color-dark: rgba(20, 20, 30, 0.75);
            --card-bg-color: rgba(255, 255, 255, 0.6);
            --card-bg-color-dark: rgba(30, 41, 59, 0.6);
            --text-color: #0f172a;
            --text-color-dark: #e2e8f0;
            --text-color-secondary: #475569;
            --text-color-secondary-dark: #94a3b8;
            --primary-color: #0d9488; /* Updated teal */
            --primary-color-light: #2dd4bf;
            --primary-color-dark: #14b8a6;
            --accent-color-1: #22c55e;
            --accent-color-2: #8b5cf6;
            --accent-color-3: #ec4899;
            --sos-color: #ef4444;
            --border-color: rgba(0, 0, 0, 0.07);
            --border-color-dark: rgba(255, 255, 255, 0.12);
            --shadow-color: rgba(100, 116, 139, 0.1);
            --font-family: 'Poppins', sans-serif;
            --color-surface: #ffffff;
            --color-text: #1a202c;
            --color-primary: #0d9488;
            --color-secondary: #f1f5f9;
            --color-border: #e2e8f0;
            --color-card-border: #e2e8f0;
            --color-card-border-inner: #e2e8f0;
            --color-btn-primary-text: white;
            --color-error: #e53e3e;
            --color-success: #38a169;
            --color-warning: #dd6b20;
            --color-bg-1: rgba(59, 130, 246, 0.1);
            --color-bg-2: rgba(245, 158, 11, 0.1);
            --color-bg-3: rgba(34, 197, 94, 0.1);
            --color-bg-4: rgba(239, 68, 68, 0.1);
            --color-bg-6: rgba(249, 115, 22, 0.1);
            --space-4: 4px; --space-8: 8px; --space-12: 12px; --space-16: 16px; --space-20: 20px; --space-24: 24px; --space-32: 32px;
            --radius-sm: 6px; --radius-base: 8px; --radius-lg: 16px; /* Increased radius */ --radius-full: 9999px;
            --font-size-sm: 12px; --font-size-base: 14px; --font-size-lg: 16px; --font-size-xl: 18px; --font-size-2xl: 20px; --font-size-3xl: 24px; --font-size-4xl: 30px;
            --font-weight-medium: 500; --font-weight-semibold: 600; --font-weight-bold: 700;
        }

        [data-theme="dark"] {
            --bg-color: var(--bg-color-dark);
            --card-bg-color: var(--card-bg-color-dark);
            --text-color: var(--text-color-dark);
            --text-color-secondary: var(--text-color-secondary-dark);
            --border-color: var(--border-color-dark);
            --primary-color: var(--primary-color-dark);
            --color-surface: #1e293b;
            --color-text: #e2e8f0;
            --color-secondary: #334155;
            --color-border: #475569;
            --color-card-border: #475569;
            --color-card-border-inner: #475569;
            --color-btn-primary-text: #ffffff;
            --color-error: #fc8181;
            --color-success: #68d391;
            --color-warning: #f6ad55;
            --shadow-color: rgba(0, 0, 0, 0.2);
        }
        
        html { scroll-behavior: smooth; }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: var(--font-family); background-color: var(--bg-color); color: var(--text-color); line-height: 1.6; transition: background-color 0.4s, color 0.4s; overflow-x: hidden; min-width: 320px; }
        .main-container { position: relative; min-height: 100vh; width: 100vw; display: flex; flex-direction: column; }
        .background-image { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: url('https://i.ibb.co/84XpXLXW/hero-pic.png'); background-size: cover; background-position: center; filter: blur(14px) brightness(0.9); transform: scale(1.15); z-index: -1; transition: filter 0.4s; }
        [data-theme="dark"] .background-image { filter: blur(14px) brightness(0.6); }
        .page-content { flex-grow: 1; padding: 1rem; max-width: 1200px; margin: 0 auto; width: 100%; padding-top: 100px; }
        
        .header {
            position: fixed;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 2rem);
            max-width: 1200px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1.25rem;
            z-index: 1000;
            background-color: var(--card-bg-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            box-shadow: 0 8px 32px 0 var(--shadow-color);
            transition: all 0.3s ease;
        }
        
        .header .logo { font-size: 1.5rem; font-weight: 700; cursor: pointer; color: var(--primary-color); }
        .header nav { display: flex; align-items: center; gap: 0.25rem; }
        .header nav a { text-decoration: none; color: var(--text-color-secondary); font-weight: 500; padding: 0.5rem 1rem; border-radius: 999px; transition: all 0.25s ease; cursor: pointer; position: relative;}
        .header nav a.active { color: var(--text-color); background-color: rgba(128, 128, 128, 0.15); }
        .header nav a:hover { color: var(--text-color); background-color: rgba(128, 128, 128, 0.1); }
        .header .actions { display: flex; align-items: center; gap: 0.75rem; }
        
        /* Language Dropdown Styles */
        .language-dropdown {
            position: relative;
            display: inline-block;
        }
        .language-dropdown-toggle {
            cursor: pointer;
            gap: 8px;
            background: transparent;
            border: none;
            color: var(--text-color-secondary);
            font-size: var(--font-size-base);
            font-weight: 500;
            padding: var(--space-8);
            display: flex;
            align-items: center;
            border-radius: var(--radius-full);
            transition: all 0.25s ease;
        }
        .language-dropdown-toggle:hover {
            color: var(--text-color);
            background-color: rgba(128, 128, 128, 0.1);
        }
        .language-dropdown-toggle svg {
            stroke: var(--text-color-secondary);
            transition: transform 0.2s ease;
        }
        .language-dropdown.open .language-dropdown-toggle svg {
            transform: rotate(180deg);
        }
        .language-dropdown-menu {
            display: none;
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            min-width: 150px;
            border-radius: var(--radius-lg);
            padding: var(--space-8);
            background: var(--card-bg-color);
            border: 1px solid var(--border-color);
            z-index: 1001;
            max-height: 200px;
            overflow-y: auto;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.2s ease, transform 0.2s ease;
            box-shadow: 0 8px 32px 0 var(--shadow-color);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
        }
        .language-dropdown.open .language-dropdown-menu {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        .language-option {
            display: block;
            padding: var(--space-8) var(--space-12);
            color: var(--text-color-secondary);
            border-radius: var(--radius-base);
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            background: none;
            border: none;
            width: 100%;
        }
        .language-option:hover {
            background-color: rgba(128, 128, 128, 0.1);
            color: var(--text-color);
        }

        .btn { padding: 0.6rem 1.2rem; border-radius: 9999px; border: none; cursor: pointer; font-weight: 600; font-size: var(--font-size-base); font-family: var(--font-family); transition: all 0.25s ease; white-space: nowrap; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0,0,0,0.12); filter: brightness(1.05); }
        .btn:active { transform: translateY(-1px); }
        .btn-outline { background-color: transparent; border: 2px solid var(--primary-color); color: var(--primary-color); }
        .btn-outline:hover { background-color: var(--primary-color); color: var(--color-btn-primary-text); }
        .btn-sos { background-color: var(--sos-color); color: white; }
        .btn-primary { background-color: var(--primary-color); color: var(--color-btn-primary-text); border: 2px solid var(--primary-color); }
        .btn-primary:hover { background-color: var(--primary-color-dark); border-color: var(--primary-color-dark); }
        
        .dashboard { margin-top: 1rem; display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; }
        .left-column { display: flex; flex-direction: column; gap: 1.5rem; }
        .recap-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        .recap-card { background-color: rgba(255,255,255,0.2); }
        [data-theme="dark"] .recap-card { background-color: rgba(0,0,0,0.2); }
        
        .card { 
            background-color: var(--card-bg-color); 
            border-radius: var(--radius-lg); 
            padding: 1.5rem; 
            border: 1px solid var(--border-color); 
            backdrop-filter: blur(24px); 
            -webkit-backdrop-filter: blur(24px); 
            box-shadow: 0 8px 32px 0 var(--shadow-color); 
            transition: all 0.3s ease; 
            position: relative; 
            overflow: hidden; 
        }
        .card:hover { transform: translateY(-5px); box-shadow: 0 12px 40px 0 var(--shadow-color); }

        .welcome-banner { background: linear-gradient(45deg, var(--primary-color), var(--primary-color-light)); color: white; display: flex; justify-content: space-between; align-items: center; }
        .welcome-banner h1 { font-size: 2rem; margin-bottom: 0.5rem; font-weight: var(--font-weight-bold); }
        .welcome-banner p { opacity: 0.9; }
        .welcome-banner-art { position: absolute; bottom: -20px; right: -20px; opacity: 0.15; pointer-events: none; transform: scale(1.1); }
        
        .ai-chat-card { display: flex; justify-content: space-between; align-items: center; background-color: rgba(139, 92, 246, 0.1); border-color: rgba(139, 92, 246, 0.2); }
        [data-theme="dark"] .ai-chat-card { background-color: rgba(139, 92, 246, 0.2); border-color: rgba(139, 92, 246, 0.3); }
        .ai-chat-card h2 { margin-bottom: 0.5rem; color: #7c3aed; font-weight: var(--font-weight-semibold); }
        [data-theme="dark"] .ai-chat-card h2 { color: #a78bfa; }
        .ai-chat-card p { color: #6d28d9; }
        [data-theme="dark"] .ai-chat-card p { color: #c4b5fd; }
        .ai-chat-card .btn { background-color: #7c3aed; color: white; margin-top: 1rem; }
        .ai-chat-card:hover { border-color: rgba(139, 92, 246, 0.5); }
        .ai-chat-icon { position: absolute; right: 1.5rem; top: 50%; transform: translateY(-50%); opacity: 0.15; color: #7c3aed; transition: transform 0.3s ease; }
        .ai-chat-card:hover .ai-chat-icon { transform: translateY(-50%) scale(1.1); }

        .recap-card h3 { font-size: 1rem; margin-bottom: 0.5rem; font-weight: var(--font-weight-semibold); }
        .recap-card p { color: var(--text-color-secondary); font-size: 0.9rem; }
        .sidebar { display: flex; flex-direction: column; gap: 1.5rem; }
        .sidebar h2 { font-size: 1.25rem; font-weight: 600; padding: 0 1rem; }
        .resource-card { display: flex; align-items: center; gap: 1rem; cursor: pointer; }
        .resource-card .icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white; flex-shrink: 0; }
        .icon.bg-green { background-image: linear-gradient(45deg, #22c55e, #4ade80); }
        .icon.bg-indigo { background-image: linear-gradient(45deg, #8b5cf6, #a78bfa); }
        .icon.bg-pink { background-image: linear-gradient(45deg, #ec4899, #f9a8d4); }
        .resource-card h3 { font-size: 1rem; font-weight: var(--font-weight-semibold); }
        .resource-card p { font-size: 0.875rem; color: var(--text-color-secondary); }
        
        .theme-toggle { position: fixed; bottom: 1.5rem; right: 1.5rem; background-color: var(--card-bg-color); border: 1px solid var(--border-color); border-radius: 999px; padding: 0.75rem; cursor: pointer; backdrop-filter: blur(10px); z-index: 1001; transition: all 0.3s ease; }
        .theme-toggle:hover { transform: scale(1.1) rotate(15deg); }
        
        .screen { display: none; }
        .screen.active { display: block; animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .container { width: 100%; margin: 0 auto; }
        .back-btn { margin-bottom: var(--space-24); background: var(--color-secondary); color: var(--text-color);}
        .assessment-header, .chat-header, .resources-header, .booking-header, .journey-header { text-align: center; margin-bottom: 2rem; }
        .assessment-header h1, .chat-header h1, .resources-header h1, .booking-header h1, .journey-header h1 { font-size: 2rem; margin-top: 1rem; margin-bottom: 0.5rem; font-weight: var(--font-weight-bold);}
        .assessment-container, .booking-container { max-width: 800px; margin: 0 auto; }
        .chat-container { max-width: 800px; margin: 0 auto; }
        .assessment-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--space-24); }
        .assessment-option { background: var(--card-bg-color); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: var(--space-24); text-align: center; transition: all 0.3s ease; }
        .assessment-option:hover { transform: translateY(-5px); box-shadow: 0 12px 40px 0 var(--shadow-color); border-color: var(--primary-color); }
        .assessment-option h3 { color: var(--primary-color); }
        .progress-bar { background: var(--color-secondary); border-radius: var(--radius-full); height: 8px; margin-bottom: var(--space-24); overflow: hidden; }
        .progress-fill { background: var(--primary-color); height: 100%; border-radius: var(--radius-full); transition: width 0.3s ease; width: 0%; }
        .question-container { background: var(--card-bg-color); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: var(--space-32); margin-bottom: var(--space-24); }
        .question-options { display: flex; flex-direction: column; gap: var(--space-12); margin-top: var(--space-24); }
        .question-option { background: var(--color-secondary); border: 2px solid transparent; border-radius: var(--radius-base); padding: var(--space-16); cursor: pointer; transition: all 0.2s ease; }
        .question-option:hover { border-color: var(--primary-color); transform: translateX(5px); }
        .question-option.selected { border-color: var(--primary-color); background-color: rgba(13, 148, 136, 0.2); }
        .question-navigation { display: flex; justify-content: space-between; }
        .results-container { text-align: center; }
        .result-card { background: var(--card-bg-color); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: var(--space-32); margin: 2rem auto; max-width: 400px; }
        .score-number { font-size: 48px; font-weight: var(--font-weight-bold); color: var(--primary-color); }
        .risk-level { padding: var(--space-12) var(--space-24); border-radius: var(--radius-full); font-weight: var(--font-weight-medium); margin: var(--space-16) 0; display: inline-block;}
        .risk-minimal { background: var(--color-bg-3); color: var(--color-success); }
        .risk-mild { background: var(--color-bg-2); color: var(--color-warning); }
        .risk-moderate { background: var(--color-bg-6); color: var(--color-orange-500); }
        .risk-severe { background: var(--color-bg-4); color: var(--color-error); }
        .recommendations { text-align: left; }
        .recommendations-list { background: var(--color-secondary); border-radius: var(--radius-base); padding: var(--space-24); }
        .recommendation-item { margin-bottom: var(--space-12); padding-left: var(--space-20); position: relative; }
        .recommendation-item:before { content: "✓"; color: var(--primary-color); position: absolute; left: 0; font-weight: bold;}
        .next-steps { display: flex; flex-wrap: wrap; gap: var(--space-16); justify-content: center; margin-top: var(--space-32); }
        
        /* --- RESPONSIVENESS FIX: CHAT CONTAINER --- */
        .chat-container { height: calc(100vh - 220px); max-height: 700px; display: flex; flex-direction: column; }
        
        .chat-messages { flex: 1; overflow-y: auto; padding: var(--space-16); background: var(--card-bg-color); border: 1px solid var(--border-color); border-radius: var(--radius-lg) var(--radius-lg) 0 0; }
        .message { margin-bottom: var(--space-16); display: flex; flex-direction: column; max-width: 90%; }
        .bot-message { align-items: flex-start; }
        .user-message { align-items: flex-end; align-self: flex-end;}
        .message-content { padding: var(--space-12) var(--space-16); border-radius: var(--radius-lg); background: var(--color-secondary); word-wrap: break-word; }
        .bot-message .message-content.crisis-message { background-color: #dc2626; color: #ffffff !important; font-weight: 600 !important; border: 2px solid #b91c1c !important; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3) !important; }
        .bot-message .message-content.crisis-message::before { content: "⚠️ "; margin-right: 8px; font-weight: bold; }
        #typing-indicator .typing-dot { width: 8px; height: 8px; background-color: var(--text-color-secondary); border-radius: 50%; display: inline-block; margin: 0 2px; animation: typing-wave 1.3s infinite ease-in-out; }
        #typing-indicator .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        #typing-indicator .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing-wave { 0%, 60%, 100% { transform: initial; } 30% { transform: translateY(-8px); } }
        .bot-message .message-content.recommendation-message { background-color: var(--color-bg-3); border: 1px solid var(--color-success); color: var(--color-text); }
        [data-theme="dark"] .bot-message .message-content.recommendation-message { background-color: rgba(var(--color-success-rgb), 0.15); border-color: rgba(var(--color-success-rgb), 0.3); }
        .user-message .message-content { background: var(--primary-color); color: var(--color-btn-primary-text); }
        .message-time { font-size: 10px; color: var(--text-color-secondary); margin-top: var(--space-4); }
        .chat-input-container { background: var(--card-bg-color); border: 1px solid var(--border-color); border-top: none; border-radius: 0 0 var(--radius-lg) var(--radius-lg); padding: var(--space-16); }
        .chat-input { display: flex; gap: var(--space-12); margin-bottom: var(--space-12); }
        .form-control { width: 100%; padding: 0.85rem; border-radius: 8px; border: 1px solid var(--border-color); background-color: var(--color-secondary); color: var(--text-color); transition: all 0.3s; }
        .form-control:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.3); outline: none; }
        .quick-responses { display: flex; flex-wrap: wrap; gap: var(--space-8); }
        .quick-response { background: var(--color-secondary); border: 1px solid var(--border-color); border-radius: var(--radius-full); padding: var(--space-4) var(--space-12); font-size: var(--font-size-sm); cursor: pointer; transition: all 0.2s; }
        .quick-response:hover { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }
        .image-preview { margin-top: 8px; }
        .image-preview img { max-height: 120px; border-radius: 8px; border: 1px solid var(--border-color); }
        .resources-categories { display: flex; flex-direction: column; gap: var(--space-32); }
        .resource-category h3 { margin-bottom: var(--space-20); color: var(--primary-color); }
        .resource-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-20); }
        .resource-item { background: var(--card-bg-color); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: var(--space-20); transition: all 0.3s ease; }
        .resource-item:hover { transform: translateY(-5px); box-shadow: 0 12px 40px 0 var(--shadow-color); border-color: var(--primary-color);}
        .resource-type { background: var(--color-secondary); color: var(--primary-color); padding: var(--space-4) var(--space-8); border-radius: var(--radius-sm); font-size: 11px; font-weight: var(--font-weight-medium); display: inline-block; margin-top: 1rem; }
        .counselor-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-20); }
        .counselor-card { background: var(--card-bg-color); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: var(--space-24); text-align: center; transition: all 0.3s ease;}
        .counselor-card:hover { transform: translateY(-5px); box-shadow: 0 12px 40px 0 var(--shadow-color); border-color: var(--primary-color); }
        .calendar-container { background: var(--card-bg-color); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: var(--space-20); margin-bottom: var(--space-24); }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-20); }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: var(--space-4); text-align: center;}
        .calendar-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: var(--radius-full); cursor: pointer; transition: all 0.2s ease; }
        .calendar-day.available:hover { background: var(--color-secondary); }
        .calendar-day.available { background: var(--color-bg-3); color: var(--color-success); }
        .calendar-day.selected { background: var(--primary-color); color: white; transform: scale(1.1); }
        .time-slots { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: var(--space-12); }
        .time-slot { background: var(--color-secondary); border: 1px solid var(--border-color); border-radius: var(--radius-base); padding: var(--space-12); text-align: center; cursor: pointer; transition: all 0.2s ease; }
        .time-slot.selected, .time-slot:hover { background: var(--primary-color); color: white; transform: scale(1.05); }
        
        .appointment-type { display: block; background: var(--card-bg-color); border: 2px solid var(--border-color); border-radius: var(--radius-lg); padding: var(--space-20); cursor: pointer; margin-bottom: 1rem; transition: all 0.2s ease; }
        .appointment-type:has(input:checked) { border-color: var(--primary-color); background-color: rgba(13, 148, 136, 0.1); }
        .appointment-type-content { display: flex; align-items: center; gap: var(--space-16); }
        .appointment-icon { flex-shrink: 0; width: 40px; height: 40px; background-color: var(--color-secondary); border-radius: var(--radius-base); display: flex; align-items: center; justify-content: center; color: var(--primary-color); transition: all 0.2s ease; }
        .appointment-type:has(input:checked) .appointment-icon { background-color: var(--primary-color); color: white; }
        
        .appointment-summary { background: var(--color-secondary); border-radius: var(--radius-lg); padding: var(--space-24); margin-bottom: var(--space-24); }
        .summary-item { display: flex; justify-content: space-between; padding-bottom: var(--space-12); margin-bottom: var(--space-12); border-bottom: 1px solid var(--border-color); }
        .summary-item:last-child { border: none; }
        .booking-navigation { display: flex; justify-content: space-between; margin-top: 1.5rem; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(5px); }
        .hidden { display: none !important; }
        .modal-content { background: var(--card-bg-color); border-radius: 24px; padding: 2rem; border: 1px solid var(--border-color); width: 90%; max-width: 450px; text-align: center; animation: modal-pop 0.3s ease-out; }
        @keyframes modal-pop { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .modal-content h3 { color: var(--color-success); margin-bottom: 1rem; }
        .journey-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; margin-top: 2rem; }
        .chart-card { background-color: var(--card-bg-color); border-radius: var(--radius-lg); padding: 1.5rem; border: 1px solid var(--border-color); backdrop-filter: blur(24px); box-shadow: 0 8px 32px 0 var(--shadow-color); }
        .chart-card h3 { margin-bottom: 1.5rem; text-align: center; }
        .chart-container { height: 350px; position: relative; }

        /* --- RESPONSIVENESS FIX: MEDIA QUERIES --- */
        @media (max-width: 992px) { 
            .dashboard { grid-template-columns: 1fr; } 
            .journey-grid { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) { 
            .header { 
                position: static; 
                transform: none; 
                width: 100%; 
                border-radius: 0; 
                padding: 1rem;
                height: auto;
                flex-direction: column;
                gap: 1rem;
            } 
            .header nav { 
                flex-wrap: wrap;
                justify-content: center;
                gap: 0.5rem;
            }
            .header .actions {
                flex-wrap: wrap;
                justify-content: center;
            }
            .page-content { padding-top: 1.5rem; } 
            .recap-grid { grid-template-columns: 1fr; } 
            .welcome-banner { flex-direction: column; text-align: center; gap: 1rem; }
            .welcome-banner-art { display: none; }
            .ai-chat-card { flex-direction: column; text-align: center; gap: 1rem; }
            .ai-chat-icon { display: none; }
            .welcome-banner h1 { font-size: 1.5rem; }
            .assessment-header h1, .chat-header h1, .resources-header h1, .booking-header h1, .journey-header h1 { font-size: 1.5rem; }
        }
         @media (max-width: 480px) {
            .header nav a { padding: 0.5rem 0.75rem; font-size: 0.9rem; }
            .btn { padding: 0.5rem 1rem; font-size: 0.9rem; }
         }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="background-image"></div>
        
        <header class="header">
            <div class="logo" data-screen="dashboardScreen">SAHARA</div>
            <nav>
                <a data-screen="dashboardScreen" class="active" data-key="home">Home</a>
                <a data-screen="journeyScreen" data-key="my_journey">My Journey</a>
                <a data-screen="resourcesScreen" data-key="resources">Resources</a>
            </nav>
            <div class="actions">
                <div class="language-dropdown">
                    <button class="language-dropdown-toggle">
                        <span id="selectedLanguage">English</span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                    </button>
                    <div class="language-dropdown-menu">
                        <a class="language-option" data-lang="en">English</a>
                        <a class="language-option" data-lang="hi">हिंदी</a>
                        <a class="language-option" data-lang="as">Assamese</a>
                        <a class="language-option" data-lang="bn">Bengali</a>
                        <a class="language-option" data-lang="gu">Gujarati</a>
                        <a class="language-option" data-lang="kn">Kannada</a>
                        <a class="language-option" data-lang="ml">Malayalam</a>
                        <a class="language-option" data-lang="mr">Marathi</a>
                        <a class="language-option" data-lang="or">Odia</a>
                        <a class="language-option" data-lang="pa">Punjabi</a>
                        <a class="language-option" data-lang="ta">Tamil</a>
                        <a class="language-option" data-lang="te">Telugu</a>
                    </div>
                </div>
                <button class="btn btn-outline" id="logoutBtn" data-key="logout">Logout</button>
                <button class="btn btn-sos" data-key="sos">SOS</button>
            </div>
        </header>

        <div class="page-content">
            <main class="main">
                 <section id="dashboardScreen" class="screen active">
                    <div class="dashboard">
                        <div class="left-column">
                            <div class="welcome-banner card">
                                <div>
                                    <h1 data-key="welcome_back">Welcome back,</h1>
                                    <p data-key="welcome_subtitle">Your path to well-being continues.</p>
                                </div>
                                <div class="welcome-banner-art">
                                     <svg width="200" height="150" viewBox="0 0 200 121" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M51.2534 109.243C17.0391 113.52 -13.625 87.1643 12.0191 60.281C26.9037 44.5034 50.8431 43.1118 69.4312 28.3241C88.0193 13.5364 92.5192 -10.027 114.28 3.51505C136.04 17.0571 130.65 41.5975 146.993 54.8087C163.336 68.0199 189.702 68.1251 188.757 91.0185C187.812 113.912 159.204 115.021 138.823 118.531C118.441 122.04 85.4678 104.966 51.2534 109.243Z" fill="white"/>
                                        <path d="M19.0911 25.7949C-3.46872 32.8989 -4.28206 64.6337 21.0163 71.916C34.4533 76.0142 51.3551 70.3631 63.315 60.1221C75.275 49.8812 79.0827 31.9592 69.1352 20.2198C59.1877 8.48037 41.6509 18.6909 19.0911 25.7949Z" fill="white"/>
                                    </svg>
                                </div>
                            </div>

                            <div class="ai-chat-card card" data-screen="chatScreen">
                                <div>
                                    <h2 data-key="ai_chat_title">AI Support Chat</h2>
                                    <p data-key="ai_chat_subtitle">Immediate, confidential support, 24/7.</p>
                                    <button class="btn" data-key="ai_chat_button">Start a Conversation</button>
                                </div>
                                <div class="ai-chat-icon">
                                    <svg width="100" height="100" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M9 12.5C9 12.5 9 12.8333 9.5 13.5C10 14.1667 10.5 15 12 15C13.5 15 14 14.1667 14.5 13.5C15 12.8333 15 12.5 15 12.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M12 21.5C17.2467 21.5 21.5 17.2467 21.5 12C21.5 6.75329 17.2467 2.5 12 2.5C6.75329 2.5 2.5 6.75329 2.5 12C2.5 17.2467 6.75329 21.5 12 21.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M15.5 9.5C15.5 9.77614 15.2761 10 15 10C14.7239 10 14.5 9.77614 14.5 9.5C14.5 9.22386 14.7239 9 15 9C15.2761 9 15.5 9.22386 15.5 9.5Z" fill="currentColor"/>
                                        <path d="M9.5 9.5C9.5 9.77614 9.27614 10 9 10C8.72386 10 8.5 9.77614 8.5 9.5C8.5 9.22386 8.72386 9 9 9C9.27614 9 9.5 9.22386 9.5 9.5Z" fill="currentColor"/>
                                    </svg>
                                </div>
                            </div>
                            <div class="recap-grid">
                                <div class="recap-card card">
                                    <h3 data-key="next_session">Your next session:</h3>
                                    <p>Tuesday, Nov 14 at 3:00 PM with Dr. Sharma</p>
                                </div>
                                 <div class="recap-card card">
                                    <h3 data-key="last_score">Last anxiety score:</h3>
                                    <p>Your result was "Mild". Try a guided meditation from the resources.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="sidebar">
                            <h2 data-key="toolkit_title">Your Toolkit</h2>
                            <div class="resource-card card" data-screen="resourcesScreen">
                                <div class="icon bg-green">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
                                </div>
                                <div>
                                    <h3 data-key="resource_library_title">Resource Library</h3>
                                    <p data-key="resource_library_subtitle">Explore articles, tools, and exercises.</p>
                                </div>
                            </div>
                            <div class="resource-card card" data-screen="assessmentScreen">
                                <div class="icon bg-indigo">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
                                </div>
                                <div>
                                    <h3 data-key="assessments_title">Assessments</h3>
                                    <p data-key="assessments_subtitle">Understand your mind better.</p>
                                </div>
                            </div>
                             <div class="resource-card card" data-screen="bookingScreen">
                                <div class="icon bg-pink">
                                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                                </div>
                                <div>
                                    <h3 data-key="booking_title">Book an Appointment</h3>
                                    <p data-key="booking_subtitle">Talk to a professional counselor.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                 <section id="journeyScreen" class="screen">
                     <div class="container">
                        <div class="journey-header">
                            <button class="btn back-btn">← Back to Dashboard</button>
                            <h1>My Journey</h1>
                            <p>Visualize your mental wellness progress over time.</p>
                        </div>
                        <div class="journey-grid">
                            <div class="chart-card">
                                <h3>Mood & Anxiety Trends (Last 40 Days)</h3>
                                <div class="chart-container">
                                    <canvas id="fortyDayChart"></canvas>
                                </div>
                            </div>
                             <div class="chart-card">
                                <h3>Weekly Check-in Summary</h3>
                                 <div class="chart-container">
                                    <canvas id="weeklyRecapChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="chatScreen" class="screen">
                    <div class="container">
                        <div class="chat-header">
                            <button class="btn back-btn">← Back to Dashboard</button>
                            <h1>AI Support Assistant</h1>
                            <p>Get immediate support and guidance. I'm here to help 24/7.</p>
                        </div>
                        <div class="chat-container">
                            <div class="chat-messages" id="chatMessages">
                                <div class="message bot-message">
                                    <div class="message-content">
                                        <p>Hello! I'm your AI mental health assistant. How are you feeling today? I'm here to provide support and resources.</p>
                                    </div>
                                    <span class="message-time">Now</span>
                                </div>
                                 <div id="typing-indicator" class="message bot-message hidden">
                                    <div class="message-content"><p>...</p></div>
                                </div>
                            </div>
                            <div class="chat-input-container">
                                <div class="chat-input">
                                    <button class="btn" id="attachImageBtn" title="Attach image">📎</button>
                                    <input type="file" id="imageInput" accept="image/*" style="display:none">
                                    <input type="text" id="chatInput" class="form-control" placeholder="Type your message here...">
                                    <button class="btn btn-primary" id="sendMessage">Send</button>
                                </div>
                                <div id="imagePreview" class="image-preview hidden"></div>
                                <div class="quick-responses">
                                    <button class="quick-response" data-message="I'm feeling anxious">I'm feeling anxious</button>
                                    <button class="quick-response" data-message="I can't sleep">I can't sleep</button>
                                    <button class="quick-response" data-message="I'm stressed about exams">I'm stressed about exams</button>
                                    <button class="quick-response" data-message="I feel lonely">I feel lonely</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="assessmentScreen" class="screen">
                    <div class="container">
                        <div class="assessment-header">
                            <button class="btn back-btn">← Back to Dashboard</button>
                            <h1>Mental Health Assessment</h1>
                            <p>Complete the PHQ-9 and GAD-7 questionnaires to get personalized insights</p>
                        </div>
                        <div class="assessment-container">
                            <div id="assessmentSelection" class="assessment-step active">
                                <div class="assessment-options">
                                    <div class="assessment-option" data-type="phq9">
                                        <h3>PHQ-9 Depression Screening</h3>
                                        <p>9 questions about depression symptoms over the past 2 weeks</p>
                                        <button class="btn btn-primary">Start PHQ-9</button>
                                    </div>
                                    <div class="assessment-option" data-type="gad7">
                                        <h3>GAD-7 Anxiety Screening</h3>
                                        <p>7 questions about anxiety symptoms over the past 2 weeks</p>
                                        <button class="btn btn-primary">Start GAD-7</button>
                                    </div>
                                </div>
                            </div>
                            <div id="assessmentQuestions" class="assessment-step">
                                <div class="progress-bar"><div class="progress-fill"></div></div>
                                <div class="question-container">
                                    <h3 id="questionText"></h3>
                                    <div id="questionOptions" class="question-options"></div>
                                </div>
                                <div class="question-navigation">
                                    <button class="btn" id="prevQuestion" disabled>Previous</button>
                                    <button class="btn btn-primary" id="nextQuestion" disabled>Next</button>
                                </div>
                            </div>
                            <div id="assessmentResults" class="assessment-step">
                                <div class="results-container">
                                    <h2>Your Assessment Results</h2>
                                    <div class="result-card">
                                        <h3 id="resultTitle"></h3>
                                        <div class="score-display">
                                            <span class="score-number" id="scoreNumber"></span><span id="scoreTotal"></span>
                                        </div>
                                        <div class="risk-level" id="riskLevel"></div>
                                    </div>
                                    <div class="recommendations">
                                        <h3>Personalized Recommendations</h3>
                                        <div id="recommendationsList" class="recommendations-list"></div>
                                    </div>
                                    <div class="next-steps">
                                        <button class="btn btn-primary" data-screen="chatScreen">Talk to AI Support</button>
                                        <button class="btn" data-screen="resourcesScreen">Explore Resources</button>
                                        <button class="btn btn-outline" id="retakeAssessment">Take Another Assessment</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
        
                <section id="resourcesScreen" class="screen">
                    <div class="container">
                        <div class="resources-header">
                            <button class="btn back-btn">← Back to Dashboard</button>
                            <h1>Resource Library</h1>
                            <p>Access educational content, exercises, and tools for mental wellness</p>
                        </div>
                        <div class="resources-categories"></div>
                    </div>
                </section>
        
                <section id="bookingScreen" class="screen">
                    <div class="container">
                        <div class="booking-header">
                            <button class="btn back-btn">← Back to Dashboard</button>
                            <h1>Book Appointment</h1>
                            <p>Schedule a session with our qualified mental health professionals</p>
                        </div>
                        <div class="booking-container">
                            <div class="booking-steps">
                                <div class="booking-step active" id="selectCounselor">
                                    <h3>Step 1: Select a Counselor</h3>
                                    <div class="counselor-list" id="counselorList"></div>
                                </div>
                                <div class="booking-step" id="selectDateTime">
                                    <h3>Step 2: Select Date & Time</h3>
                                    <div class="calendar-container">
                                        <div class="calendar-header">
                                            <button class="btn" id="prevMonth">‹</button>
                                            <h4 id="currentMonth"></h4>
                                            <button class="btn" id="nextMonth">›</button>
                                        </div>
                                        <div class="calendar-grid" id="calendarGrid"></div>
                                    </div>
                                    <div class="time-slots" id="timeSlots"></div>
                                </div>
                                <div class="booking-step" id="selectType">
                                    <h3>Step 3: Select Meeting Format</h3>
                                    <div class="appointment-types">
                                        <label class="appointment-type">
                                            <input type="radio" name="appointmentType" value="online" style="display: none;">
                                            <div class="appointment-type-content">
                                                <div class="appointment-icon">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15.6 11.6L22 7v10l-6.4-4.6Z"/><path d="M2 7h11a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1Z"/></svg>
                                                </div>
                                                <div>
                                                    <h4>Online Meeting</h4>
                                                    <p>Receive a secure video link for your session.</p>
                                                </div>
                                            </div>
                                        </label>
                                        <label class="appointment-type">
                                            <input type="radio" name="appointmentType" value="offline" style="display: none;">
                                            <div class="appointment-type-content">
                                                 <div class="appointment-icon">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 22V12h6v10"/><path d="M3 10a5 5 0 0 1 9 0a5 5 0 0 1 9 0"/><path d="M2 10h20"/></svg>
                                                 </div>
                                                 <div>
                                                     <h4>Offline Meeting</h4>
                                                     <p>In-person session at the university wellness center.</p>
                                                 </div>
                                             </div>
                                        </label>
                                    </div>
                                </div>
                                <div class="booking-step" id="confirmation">
                                    <h3>Step 4: Confirm Appointment</h3>
                                    <div class="appointment-summary">
                                        <div class="summary-item"><strong>Counselor:</strong> <span id="confirmedCounselor"></span></div>
                                        <div class="summary-item"><strong>Date:</strong> <span id="confirmedDate"></span></div>
                                        <div class="summary-item"><strong>Time:</strong> <span id="confirmedTime"></span></div>
                                        <div class="summary-item"><strong>Format:</strong> <span id="confirmedType"></span></div>
                                    </div>
                                    <button class="btn btn-primary" id="confirmBooking">Confirm Appointment</button>
                                </div>
                            </div>
                            <div class="booking-navigation">
                                <button class="btn" id="prevStep" disabled>Previous</button>
                                <button class="btn btn-primary" id="nextStep" disabled>Next</button>
                            </div>
                        </div>
                    </div>
                </section>

            </main>
        </div>

        <div class="theme-toggle" id="themeToggle">
            <svg id="themeIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
        </div>

        <div id="successModal" class="modal hidden">
            <div class="modal-content">
                <h3>Success!</h3>
                <p id="successMessage">Your appointment has been booked successfully.</p>
                <button class="btn btn-primary" id="closeModal">Close</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const API_BASE_URL = 'https://nahidwin-naim.onrender.com/v1';
            let user = null;
            // Persist language across pages using localStorage
            let currentLanguage = localStorage.getItem('appLanguage') || 'en'; // Language state
            // One-time guard to avoid repeating the referral action button in chat
            let referralButtonShown = false;
            // Pending image attachment (data URL)
            let pendingImageBase64 = null;

            // Translations object for UI text
            const translations = {
                en: {
                    home: "Home", my_journey: "My Journey", resources: "Resources", logout: "Logout", sos: "SOS",
                    welcome_back: "Welcome back,", welcome_subtitle: "Your path to well-being continues.",
                    ai_chat_title: "AI Support Chat", ai_chat_subtitle: "Immediate, confidential support, 24/7.", ai_chat_button: "Start a Conversation",
                    next_session: "Your next session:", last_score: "Last anxiety score:", toolkit_title: "Your Toolkit",
                    resource_library_title: "Resource Library", resource_library_subtitle: "Explore articles, tools, and exercises.",
                    assessments_title: "Assessments", assessments_subtitle: "Understand your mind better.",
                    booking_title: "Book an Appointment", booking_subtitle: "Talk to a professional counselor."
                },
                hi: {
                    home: "होम", my_journey: "मेरी यात्रा", resources: "संसाधन", logout: "लॉग आउट", sos: "एसओएस",
                    welcome_back: "वापसी पर स्वागत है,", welcome_subtitle: "कल्याण की ओर आपका मार्ग जारी है।",
                    ai_chat_title: "एआई सहायता चैट", ai_chat_subtitle: "तुरंत, गोपनीय सहायता, 24/7।", ai_chat_button: "बातचीत शुरू करें",
                    next_session: "आपका अगला सत्र:", last_score: "पिछला चिंता स्कोर:", toolkit_title: "आपकी टूलकिट",
                    resource_library_title: "संसाधन पुस्तकालय", resource_library_subtitle: "लेख, उपकरण और अभ्यास खोजें।",
                    assessments_title: "मूल्यांकन", assessments_subtitle: "अपने मन को बेहतर समझें।",
                    booking_title: "अपॉइंटमेंट बुक करें", booking_subtitle: "एक पेशेवर परामर्शदाता से बात करें।"
                }
            };

            function checkAuth() {
                const isLoggedIn = sessionStorage.getItem('isLoggedIn');
                const userData = sessionStorage.getItem('user');
                if (!isLoggedIn || !userData) {
                    alert('You must be logged in to view this page.');
                    window.location.href = 'index.html';
                    return false;
                }
                user = JSON.parse(userData);
                const welcomeBanner = document.querySelector('.welcome-banner h1');
                if (welcomeBanner && user.fullName) {
                    welcomeBanner.textContent = `Welcome back, ${user.fullName.split(' ')[0]}`;
                }
                return true;
            }

            function updateUIText() {
                const langPack = translations[currentLanguage] || translations.en;
                document.querySelectorAll('[data-key]').forEach(element => {
                    const key = element.getAttribute('data-key');
                    if (key === 'welcome_back') return; // Skip the welcome banner h1 as it's dynamic
                    if (langPack[key]) {
                        element.textContent = langPack[key];
                    }
                });
                
                // Special handling for the dynamic welcome message
                const welcomeBannerH1 = document.querySelector('.welcome-banner h1');
                if (welcomeBannerH1 && user && user.fullName) {
                     const welcomeText = langPack.welcome_back || translations.en.welcome_back;
                     welcomeBannerH1.textContent = `${welcomeText} ${user.fullName.split(' ')[0]}`;
                }
            }
            
            function setupLanguageSwitcher() {
                const languageDropdown = document.querySelector('.language-dropdown');
                if (!languageDropdown) return;
                const dropdownToggle = languageDropdown.querySelector('.language-dropdown-toggle');
                const languageOptions = languageDropdown.querySelectorAll('.language-option');
                const selectedLanguageSpan = document.getElementById('selectedLanguage');

                // Initialize UI with saved language
                const savedLang = localStorage.getItem('appLanguage');
                if (savedLang) {
                    const opt = languageDropdown.querySelector(`.language-option[data-lang="${savedLang}"]`);
                    if (opt) selectedLanguageSpan.textContent = opt.textContent;
                }

                dropdownToggle.addEventListener('click', () => {
                    languageDropdown.classList.toggle('open');
                });

                document.addEventListener('click', (e) => {
                    if (!languageDropdown.contains(e.target)) {
                        languageDropdown.classList.remove('open');
                    }
                });

                languageOptions.forEach(option => {
                    option.addEventListener('click', (e) => {
                        e.preventDefault();
                        const lang = option.getAttribute('data-lang');
                        const langText = option.textContent;

                        if (lang) {
                            currentLanguage = lang;
                            localStorage.setItem('appLanguage', lang);
                            updateUIText();
                        }

                        selectedLanguageSpan.textContent = langText;
                        languageDropdown.classList.remove('open');
                    });
                });
            }

            const appData = {
                phq9_questions: { en: [{"id": "PHQ9_Q1", "text": "Little interest or pleasure in doing things", "options": ["Not at all (0)", "Several days (1)", "More than half the days (2)", "Nearly every day (3)"]}, {"id": "PHQ9_Q2", "text": "Feeling down, depressed, or hopeless", "options": ["Not at all (0)", "Several days (1)", "More than half the days (2)", "Nearly every day (3)"]}, {"id": "PHQ9_Q3", "text": "Trouble falling or staying asleep, or sleeping too much", "options": ["Not at all (0)", "Several days (1)", "More than half the days (2)", "Nearly every day (3)"]}, {"id": "PHQ9_Q4", "text": "Feeling tired or having little energy", "options": ["Not at all (0)", "Several days (1)", "More than half the days (2)", "Nearly every day (3)"]}, {"id": "PHQ9_Q5", "text": "Poor appetite or overeating", "options": ["Not at all (0)", "Several days (1)", "More than half the days (2)", "Nearly every day (3)"]}, {"id": "PHQ9_Q6", "text": "Feeling bad about yourself — or that you are a failure", "options": ["Not at all (0)", "Several days (1)", "More than half the days (2)", "Nearly every day (3)"]}, {"id": "PHQ9_Q7", "text": "Trouble concentrating on things", "options": ["Not at all (0)", "Several days (1)", "More than half the days (2)", "Nearly every day (3)"]}, {"id": "PHQ9_Q8", "text": "Moving or speaking slowly or being restless", "options": ["Not at all (0)", "Several days (1)", "More than half the days (2)", "Nearly every day (3)"]}, {"id": "PHQ9_Q9", "text": "Thoughts that you would be better off dead", "options": ["Not at all (0)", "Several days (1)", "More than half the days (2)", "Nearly every day (3)"]}] },
                gad7_questions: { en: [{"id": "GAD7_Q1", "text": "Feeling nervous, anxious or on edge", "options": ["Not at all (0)", "Several days (1)", "More than half the days (2)", "Nearly every day (3)"]}, {"id": "GAD7_Q2", "text": "Not being able to stop or control worrying", "options": ["Not at all (0)", "Several days (1)", "More than half the days (2)", "Nearly every day (3)"]}, {"id": "GAD7_Q3", "text": "Worrying too much about different things", "options": ["Not at all (0)", "Several days (1)", "More than half the days (2)", "Nearly every day (3)"]}, {"id": "GAD7_Q4", "text": "Trouble relaxing", "options": ["Not at all (0)", "Several days (1)", "More than half the days (2)", "Nearly every day (3)"]}, {"id": "GAD7_Q5", "text": "Being so restless that it is hard to sit still", "options": ["Not at all (0)", "Several days (1)", "More than half the days (2)", "Nearly every day (3)"]}, {"id": "GAD7_Q6", "text": "Becoming easily annoyed or irritable", "options": ["Not at all (0)", "Several days (1)", "More than half the days (2)", "Nearly every day (3)"]}, {"id": "GAD7_Q7", "text": "Feeling afraid as if something awful might happen", "options": ["Not at all (0)", "Several days (1)", "More than half the days (2)", "Nearly every day (3)"]}] },
                counselors: [ {"id": "C001", "name": "Dr. Sarah Johnson", "specialization": "Anxiety and Depression"}, {"id": "C002", "name": "Dr. Rajesh Kumar", "specialization": "Student Counseling"}],
                resources: [
                    { category: "CBT Modules", items: [{ title: "Thought Record Exercise", description: "Track and analyze your thoughts", type: "Worksheet" }, { title: "Cognitive Restructuring", description: "Challenge negative thinking patterns", type: "Module" }] },
                    { category: "Mindfulness & Relaxation", items: [{ title: "Breathing Exercises for Anxiety", description: "Manage anxiety with breathing", type: "Video - 5 min" }, { title: "Mindfulness Meditation", description: "Guided meditation for stress", type: "Audio - 10 min" }] },
                    { category: "Educational Content", items: [{ title: "Understanding Depression", description: "Learn about symptoms and causes", type: "Article" }, { title: "Managing Academic Stress", description: "Tips for handling college pressure", type: "Guide" }] },
                    { category: "Peer Support", items: [{ title: "Student Success Stories", description: "Read how others overcame challenges", type: "Stories" }, { title: "Support Group Directory", description: "Find peer support groups", type: "Directory" }] }
                ]
            };
            let currentAssessment = null; let currentQuestionIndex = 0; let assessmentAnswers = []; let selectedCounselor = null; let selectedDate = null; let selectedTime = null; let bookingStep = 0; let currentMonth = new Date().getMonth(); let currentYear = new Date().getFullYear();
            
            function showScreen(screenId) {
                document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
                const targetScreen = document.getElementById(screenId);
                if (targetScreen) targetScreen.classList.add('active');
                document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
                const activeLink = document.querySelector(`nav a[data-screen="${screenId}"]`);
                if(activeLink) activeLink.classList.add('active');
                window.scrollTo(0, 0);
            }
            function handleLogout() {
                sessionStorage.clear();
                alert('You have been logged out.');
                window.location.href = 'index.html';
            }
            function setupNavigation() {
                document.querySelectorAll('[data-screen]').forEach(el => el.addEventListener('click', (e) => { e.preventDefault(); showScreen(el.dataset.screen); }));
                document.querySelectorAll('.back-btn').forEach(btn => btn.addEventListener('click', () => showScreen('dashboardScreen')));
            }
            function setupChat() {
                const chatInput = document.getElementById('chatInput');
                const sendBtn = document.getElementById('sendMessage');
                const attachBtn = document.getElementById('attachImageBtn');
                const imageInput = document.getElementById('imageInput');
                const imagePreview = document.getElementById('imagePreview');
                sendBtn?.addEventListener('click', sendMessage);
                chatInput?.addEventListener('keypress', e => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }});
                document.querySelectorAll('.quick-response').forEach(btn => btn.addEventListener('click', () => { chatInput.value = btn.dataset.message; sendMessage(); }));
                attachBtn?.addEventListener('click', () => imageInput?.click());
                imageInput?.addEventListener('change', (e) => {
                    const file = e.target.files && e.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = () => {
                        pendingImageBase64 = reader.result; // data URL
                        imagePreview.classList.remove('hidden');
                        imagePreview.innerHTML = `<img src="${pendingImageBase64}" alt="preview">`;
                    };
                    reader.readAsDataURL(file);
                });
            }
            async function sendMessage() {
                const input = document.getElementById('chatInput');
                const imageInput = document.getElementById('imageInput');
                const imagePreview = document.getElementById('imagePreview');
                const typingIndicator = document.getElementById('typing-indicator');
                const userMessage = (input.value || '').trim();
                if (!userMessage && !pendingImageBase64) return;
                const displayText = userMessage || (currentLanguage === 'hi' ? 'छवि संलग्न' : 'Image attached');
                addMessage(displayText, 'user', false, false, pendingImageBase64);
                input.value = '';
                typingIndicator.classList.remove('hidden');
                try {
                    const base64Raw = pendingImageBase64 ? pendingImageBase64.split(',')[1] : null;
                    const body = { message: userMessage, userId: user.studentId, language: currentLanguage };
                    if (base64Raw) body.imageData = base64Raw;
                    const response = await fetch(`${API_BASE_URL}/predict`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
                    if (!response.ok) { throw new Error(`HTTP Error: ${response.status}`); }
                    const data = await response.json();
                    const isCrisis = (data.analysis && data.analysis.crisis_detected === true) || data.is_crisis_response === true;
                    let isRecommendation = false;
                    if (data.professional_referral && data.professional_referral.text) { isRecommendation = data.professional_referral.is_recommendation === true; setTimeout(() => { addMessage(data.professional_referral.text, 'bot', false, isRecommendation); }, 800); }
                    addMessage(data.response, 'bot', isCrisis, isRecommendation);
                } catch (error) {
                    console.error('Chat Error:', error);
                    addMessage("I'm sorry, I'm having trouble connecting right now. Please try again in a moment.", 'bot');
                } finally {
                    typingIndicator.classList.add('hidden');
                    // reset attachment state
                    pendingImageBase64 = null;
                    if (imagePreview) { imagePreview.classList.add('hidden'); imagePreview.innerHTML = ''; }
                    if (imageInput) { imageInput.value = ''; }
                }
            }
            function addMessage(text, sender, isCrisis = false, isRecommendation = false, imageBase64 = null) {
                const messagesContainer = document.getElementById('chatMessages'); const msgDiv = document.createElement('div'); msgDiv.className = `message ${sender}-message`;
                function formatMessage(str) { str = str.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); return str.replace(/\n/g, '<br>'); }
                msgDiv.innerHTML = `<div class="message-content"><p>${formatMessage(text)}</p></div><span class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>`;
                const contentDiv = msgDiv.querySelector('.message-content');
                if (imageBase64 && sender === 'user') {
                    const img = document.createElement('img');
                    img.src = imageBase64; img.alt = 'attachment';
                    img.style.maxWidth = '200px'; img.style.borderRadius = '8px'; img.style.marginTop = '8px';
                    contentDiv.appendChild(img);
                }
                if (isCrisis && sender === 'bot') { contentDiv.classList.add('crisis-message'); }
                if (isRecommendation && sender === 'bot') { 
                    contentDiv.classList.add('recommendation-message');
                    // Inject a one-time Book Counselor button matching primary CTA style
                    if (!referralButtonShown) {
                        const actions = document.createElement('div');
                        actions.className = 'referral-actions';
                        actions.style.marginTop = '12px';
                        const bookBtn = document.createElement('button');
                        bookBtn.className = 'btn btn-primary';
                        bookBtn.textContent = (currentLanguage === 'hi') ? 'काउंसलर बुक करें' : 'Book Counselor';
                        bookBtn.addEventListener('click', () => { showScreen('bookingScreen'); });
                        actions.appendChild(bookBtn);
                        contentDiv.appendChild(actions);
                        referralButtonShown = true; // prevent repeats in this session
                    }
                }
                messagesContainer.insertBefore(msgDiv, document.getElementById('typing-indicator')); messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
            async function loadChatHistory() {
                if (!user || !user.studentId) return;
                try {
                    const response = await fetch(`${API_BASE_URL}/history`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ userId: user.studentId, limit: 100 }) });
                    if (!response.ok) throw new Error('Failed to fetch history');
                    const data = await response.json();
                    if (data.success && data.history) {
                        const messagesContainer = document.getElementById('chatMessages');
                        messagesContainer.innerHTML = '<div id="typing-indicator" class="message bot-message hidden"><div class="message-content"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div></div>';
                        data.history.forEach(msg => { const sender = msg.role === 'assistant' ? 'bot' : 'user'; addMessage(msg.content, sender); });
                    }
                } catch (error) { console.error("Could not load chat history:", error); addMessage("I couldn't retrieve our past conversation, but we can start a new one!", 'bot'); }
            }
            function setupAssessment() {
                document.querySelectorAll('.assessment-option button').forEach(btn => btn.addEventListener('click', (e) => startAssessment(e.target.closest('.assessment-option').dataset.type)));
                document.getElementById('nextQuestion')?.addEventListener('click', nextQuestion); document.getElementById('prevQuestion')?.addEventListener('click', prevQuestion); document.getElementById('retakeAssessment')?.addEventListener('click', resetAssessment);
            }
            function startAssessment(type) { currentAssessment = type; currentQuestionIndex = 0; assessmentAnswers = []; showAssessmentStep('assessmentQuestions'); displayQuestion(); }
            function displayQuestion() {
                const questions = currentAssessment === 'phq9' ? appData.phq9_questions.en : appData.gad7_questions.en; const question = questions[currentQuestionIndex];
                document.getElementById('questionText').textContent = question.text; const optionsContainer = document.getElementById('questionOptions'); optionsContainer.innerHTML = '';
                question.options.forEach((option, index) => { const optDiv = document.createElement('div'); optDiv.className = 'question-option'; optDiv.textContent = option; optDiv.onclick = () => selectOption(optDiv, index); if (assessmentAnswers[currentQuestionIndex] === index) optDiv.classList.add('selected'); optionsContainer.appendChild(optDiv); });
                updateProgress(); updateNavigationButtons();
            }
            function selectOption(el, value) { document.querySelectorAll('.question-option').forEach(opt => opt.classList.remove('selected')); el.classList.add('selected'); assessmentAnswers[currentQuestionIndex] = value; updateNavigationButtons(); }
            function nextQuestion() {
                 const questions = currentAssessment === 'phq9' ? appData.phq9_questions.en : appData.gad7_questions.en;
                 if (currentQuestionIndex < questions.length - 1) { currentQuestionIndex++; displayQuestion(); } else { calculateResults(); }
            }
            function prevQuestion() { if (currentQuestionIndex > 0) { currentQuestionIndex--; displayQuestion(); } }
            function updateProgress() { const questions = currentAssessment === 'phq9' ? appData.phq9_questions.en : appData.gad7_questions.en; const progress = ((currentQuestionIndex + 1) / questions.length) * 100; document.querySelector('.progress-fill').style.width = `${progress}%`; }
            function updateNavigationButtons() { document.getElementById('prevQuestion').disabled = currentQuestionIndex === 0; document.getElementById('nextQuestion').disabled = assessmentAnswers[currentQuestionIndex] === undefined; }
            function calculateResults() {
                const totalScore = assessmentAnswers.reduce((sum, answer) => sum + (answer || 0), 0); const maxScore = currentAssessment === 'phq9' ? 27 : 21; let riskLevel, riskClass, recommendations;
                if (currentAssessment === 'phq9') { if (totalScore <= 4) { riskLevel = 'Minimal Depression'; riskClass = 'risk-minimal'; recommendations = ['Continue with healthy lifestyle habits', 'Stay connected with friends and family']; } else if (totalScore <= 9) { riskLevel = 'Mild Depression'; riskClass = 'risk-mild'; recommendations = ['Practice stress management techniques', 'Monitor your mood regularly', 'Consider CBT exercises from our Resource Library']; } else if (totalScore <= 14) { riskLevel = 'Moderate Depression'; riskClass = 'risk-moderate'; recommendations = ['Strongly recommend professional counseling', 'Use our AI chat support for daily guidance', 'Practice mindfulness and relaxation techniques']; } else { riskLevel = 'Severe Depression'; riskClass = 'risk-severe'; recommendations = ['Immediate professional help is recommended', 'Contact our crisis helpline if needed', 'Book an urgent appointment with a counselor']; }
                } else { if (totalScore <= 4) { riskLevel = 'Minimal Anxiety'; riskClass = 'risk-minimal'; recommendations = ['Continue with healthy coping strategies', 'Practice relaxation techniques']; } else if (totalScore <= 9) { riskLevel = 'Mild Anxiety'; riskClass = 'risk-mild'; recommendations = ['Learn anxiety management techniques from our resources', 'Practice breathing exercises regularly', 'Consider counseling support']; } else if (totalScore <= 14) { riskLevel = 'Moderate Anxiety'; riskClass = 'risk-moderate'; recommendations = ['Professional counseling is recommended', 'Practice CBT techniques for anxiety', 'Use our mindfulness resources']; } else { riskLevel = 'Severe Anxiety'; riskClass = 'risk-severe'; recommendations = ['Immediate professional help is needed', 'Book an urgent counseling appointment', 'Contact crisis support if overwhelmed']; } }
                displayResults(totalScore, maxScore, riskLevel, riskClass, recommendations);
            }
            function displayResults(score, maxScore, riskLevel, riskClass, recommendations) {
                document.getElementById('resultTitle').textContent = `${currentAssessment.toUpperCase()} Results`; document.getElementById('scoreNumber').textContent = score; document.getElementById('scoreTotal').textContent = ` / ${maxScore}`;
                const riskEl = document.getElementById('riskLevel'); riskEl.textContent = riskLevel; riskEl.className = `risk-level ${riskClass}`;
                const recommendationsList = document.getElementById('recommendationsList'); recommendationsList.innerHTML = ''; recommendations.forEach(rec => { const item = document.createElement('div'); item.className = 'recommendation-item'; item.textContent = rec; recommendationsList.appendChild(item); });
                showAssessmentStep('assessmentResults');
            }
            function showAssessmentStep(stepId) { document.querySelectorAll('.assessment-step').forEach(s => s.classList.remove('active')); document.getElementById(stepId).classList.add('active'); }
            function resetAssessment() { showAssessmentStep('assessmentSelection'); }
            function generateResources() { const container = document.querySelector('#resourcesScreen .resources-categories'); if (!container) return; container.innerHTML = appData.resources.map(cat => `<div class="resource-category"><h3>${cat.category}</h3><div class="resource-grid">${cat.items.map(item => `<div class="resource-item"><h4>${item.title}</h4><p>${item.description}</p><span class="resource-type">${item.type}</span></div>`).join('')}</div></div>`).join(''); }
            function generateCounselors() { const container = document.getElementById('counselorList'); if (!container) return; container.innerHTML = appData.counselors.map(c => `<div class="counselor-card"><h4>${c.name}</h4><p>${c.specialization}</p><button class="btn btn-primary select-counselor" data-id="${c.id}">Select</button></div>`).join(''); document.querySelectorAll('.select-counselor').forEach(btn => btn.addEventListener('click', () => { selectedCounselor = appData.counselors.find(c => c.id === btn.dataset.id); nextBookingStep(); })); }
            function setupBooking() { document.getElementById('nextStep')?.addEventListener('click', nextBookingStep); document.getElementById('prevStep')?.addEventListener('click', prevBookingStep); document.getElementById('confirmBooking')?.addEventListener('click', confirmBooking); document.getElementById('prevMonth')?.addEventListener('click', () => navigateMonth(-1)); document.getElementById('nextMonth')?.addEventListener('click', () => navigateMonth(1)); document.querySelectorAll('input[name="appointmentType"]').forEach(radio => radio.addEventListener('change', updateBookingNavigation)); }
            function generateCalendar() {
                const calendarGrid = document.getElementById('calendarGrid'); if (!calendarGrid) return; const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                document.getElementById('currentMonth').textContent = `${monthNames[currentMonth]} ${currentYear}`; calendarGrid.innerHTML = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(d => `<div style="font-weight: 600; font-size: 0.8rem; color: var(--text-color-secondary);">${d}</div>`).join('');
                const firstDay = new Date(currentYear, currentMonth, 1).getDay(); const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
                for (let i = 0; i < firstDay; i++) calendarGrid.insertAdjacentHTML('beforeend', '<div></div>');
                for (let day = 1; day <= daysInMonth; day++) { const dayDiv = document.createElement('div'); dayDiv.className = 'calendar-day available'; dayDiv.textContent = day; dayDiv.onclick = () => selectDate(day, dayDiv); calendarGrid.appendChild(dayDiv); }
            }
            function navigateMonth(dir) { currentMonth += dir; if (currentMonth < 0) { currentMonth = 11; currentYear--; } if (currentMonth > 11) { currentMonth = 0; currentYear++; } generateCalendar(); }
            function selectDate(day, el) { document.querySelectorAll('.calendar-day.selected').forEach(d => d.classList.remove('selected')); el.classList.add('selected'); selectedDate = new Date(currentYear, currentMonth, day); generateTimeSlots(); updateBookingNavigation(); }
            function generateTimeSlots() { const container = document.getElementById('timeSlots'); container.innerHTML = ['09:00', '10:00', '11:00', '14:00', '15:00'].map(time => `<div class="time-slot">${time}</div>`).join(''); document.querySelectorAll('.time-slot').forEach(slot => { slot.addEventListener('click', () => { document.querySelectorAll('.time-slot.selected').forEach(s => s.classList.remove('selected')); slot.classList.add('selected'); selectedTime = slot.textContent; updateBookingNavigation(); }); }); }
            function nextBookingStep() { const steps = ['selectCounselor', 'selectDateTime', 'selectType', 'confirmation']; if(bookingStep >= steps.length - 1) return; document.getElementById(steps[bookingStep]).classList.remove('active'); bookingStep++; document.getElementById(steps[bookingStep]).classList.add('active'); if (bookingStep === 3) updateConfirmationSummary(); updateBookingNavigation(); }
            function prevBookingStep() { const steps = ['selectCounselor', 'selectDateTime', 'selectType', 'confirmation']; if(bookingStep <= 0) return; document.getElementById(steps[bookingStep]).classList.remove('active'); bookingStep--; document.getElementById(steps[bookingStep]).classList.add('active'); updateBookingNavigation(); }
            function updateBookingNavigation() { document.getElementById('prevStep').disabled = bookingStep === 0; let canProceed = false; if (bookingStep === 0) canProceed = !!selectedCounselor; else if (bookingStep === 1) canProceed = !!selectedDate && !!selectedTime; else if (bookingStep === 2) canProceed = !!document.querySelector('input[name="appointmentType"]:checked'); document.getElementById('nextStep').style.display = bookingStep === 3 ? 'none' : 'inline-flex'; document.getElementById('nextStep').disabled = !canProceed; }
            function updateConfirmationSummary() { document.getElementById('confirmedCounselor').textContent = selectedCounselor.name; document.getElementById('confirmedDate').textContent = selectedDate.toLocaleDateString(); document.getElementById('confirmedTime').textContent = selectedTime; const selectedTypeLabel = document.querySelector('input[name="appointmentType"]:checked').closest('.appointment-type'); const typeText = selectedTypeLabel.querySelector('h4').textContent; document.getElementById('confirmedType').textContent = typeText; }
            function confirmBooking() { document.getElementById('successModal').classList.remove('hidden'); }
            function setupModal() { document.getElementById('closeModal')?.addEventListener('click', () => { document.getElementById('successModal').classList.add('hidden'); resetBooking(); showScreen('dashboardScreen'); }); }
            function resetBooking() { bookingStep = 0; selectedCounselor = null; selectedDate = null; selectedTime = null; document.querySelectorAll('.booking-step').forEach((s, index) => { if (index === 0) s.classList.add('active'); else s.classList.remove('active'); }); const radios = document.querySelectorAll('input[name="appointmentType"]'); if (radios) radios.forEach(radio => radio.checked = false); updateBookingNavigation(); }
            function initializeJourneyCharts(){
                const generateFortyDayData = () => { const data = []; for(let i=0; i<40; i++) data.push(Math.floor(Math.random() * 15) + 3); return data; }
                const fortyDayLabels = Array.from({length: 40}, (_, i) => { const d = new Date(); d.setDate(d.getDate() - (39-i)); return `${d.getMonth()+1}/${d.getDate()}`; });
                const weeklyLabels = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']; const weeklyAnxiety = Array.from({length: 7}, () => Math.floor(Math.random() * 18)); const weeklyDepression = Array.from({length: 7}, () => Math.floor(Math.random() * 22));
                const ctxFortyDay = document.getElementById('fortyDayChart')?.getContext('2d');
                if(ctxFortyDay) { new Chart(ctxFortyDay, { type: 'line', data: { labels: fortyDayLabels, datasets: [{ label: 'Anxiety Score (GAD-7)', data: generateFortyDayData(), borderColor: 'rgba(99, 102, 241, 1)', backgroundColor: 'rgba(99, 102, 241, 0.2)', fill: true, tension: 0.4 }, { label: 'Depression Score (PHQ-9)', data: generateFortyDayData(), borderColor: 'rgba(236, 72, 153, 1)', backgroundColor: 'rgba(236, 72, 153, 0.2)', fill: true, tension: 0.4 }] }, options: { responsive: true, maintainAspectRatio: false } }); }
                const ctxWeekly = document.getElementById('weeklyRecapChart')?.getContext('2d');
                if(ctxWeekly){ new Chart(ctxWeekly, { type: 'bar', data: { labels: weeklyLabels, datasets: [{ label: 'Anxiety', data: weeklyAnxiety, backgroundColor: 'rgba(236, 72, 153, 0.7)', },{ label: 'Depression', data: weeklyDepression, backgroundColor: 'rgba(16, 185, 129, 0.7)', }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } } }); }
            }
            
            function initializeApp() {
                if (!checkAuth()) return;

                setupLanguageSwitcher(); // Add this
                
                setupNavigation();
                setupAssessment();
                setupChat();
                generateResources();
                generateCounselors();
                setupBooking();
                generateCalendar();
                setupModal();
                initializeJourneyCharts();
                loadChatHistory();

                updateUIText(); // And this

                const themeToggle = document.getElementById('themeToggle');
                const themeIcon = document.getElementById('themeIcon');
                const sunIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`;
                const moonIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`;

                themeToggle.addEventListener('click', () => {
                    if (document.body.getAttribute('data-theme') === 'dark') {
                        document.body.removeAttribute('data-theme');
                        themeIcon.innerHTML = moonIcon;
                    } else {
                        document.body.setAttribute('data-theme', 'dark');
                        themeIcon.innerHTML = sunIcon;
                    }
                });

                document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            }

            initializeApp();
        });

       
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/service-worker.js')
            .then(registration => {
              console.log('Service Worker registered successfully:', registration);
            })
            .catch(error => {
              console.log('Service Worker registration failed:', error);
            });
        });
      }
    </script>
</body>
</html>

